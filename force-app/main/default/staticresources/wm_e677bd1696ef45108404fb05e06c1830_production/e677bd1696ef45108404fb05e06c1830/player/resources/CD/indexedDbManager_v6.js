function logError(e){try{console.log("Error: "+e)}catch(n){}}function IndexedDBManager(){function e(){}function n(e,t,r,i,a){if(t)return void r(t);if(!o)return void setTimeout(function(){a||(a=0),d>a&&n(e,t,r,i,a+1)},s);var u=o.transaction([c],e);u.onerror=function(e){i&&i(e)};var l=u.objectStore(c);r&&r(l)}function t(e,t,r,o,a){n("readwrite",null,function(n){i.getItem(t,r,function(c){c=e(c||{}),i.setItem(t,r,c,o,a,n)},a,n)},a)}function r(e){e.objectStoreNames.contains(c)&&e.deleteObjectStore(c);var n=e.createObjectStore(c,{keyPath:"uniqueKey"});n.createIndex("guid","guid",{unique:!1})}this.LocalSVNRevision="$Rev: 4842 $";var o,i=this,a="WalkMeStorage",c="storage",u=2,s=50,d=5,l=indexedDB||mozIndexedDB||webkitIndexedDB||msIndexedDB;i.init=function(e){try{var n=l.open(a,u);n.onerror=function(){logError("Error starting cross domain listening")},n.onblocked=function(){logError("indexedDB open blocked")},n.onsuccess=function(){o=n.result,e&&e()},n.onupgradeneeded=function(e){r(e.target.result)}}catch(t){logError(t)}},i.testConnection=function(e,n){o?e():n()},i.setItem=function(e,t,r,o,i,a){n("readwrite",a,function(n){var a=n.put({uniqueKey:e+t,guid:e,key:t,value:r});a.onsuccess=function(){o&&o()},a.onerror=function(){i&&i()}},i)},i.getItem=function(e,t,r,o,i){n("readwrite",i,function(n){var i=n.get(e+t);i.onsuccess=function(e){var n=e.target.result,t=n?n.value:void 0;r&&r(t)},i.onerror=function(){o&&o()}},o)},i.getAll=function(e,t,r){n("readwrite",null,function(n){var r=[],o=n.index("guid"),i=IDBKeyRange.only(e);o.openCursor(i).onsuccess=function(e){var n=e.target.result;n?(void 0!==n.value.value&&r.push({key:n.value.key,saveObj:n.value.value}),n["continue"]()):t&&t(r)}},r)},i.removeItem=function(e,t,r,o){n("readwrite",null,function(n){var i=n["delete"](e+t);i.onsuccess=function(){r&&r()},i.onerror=function(){o&&o()}},o)},i.addToDictionary=function(e,n,r,o,i,a){t(function(e){var n=(e.value?JSON.parse(e.value):{})||{};return n[r]=o,e.value=JSON.stringify(n),e},e,n,i,a)},i.removeFromDictionary=function(e,n,r,o,i){t(function(e){var n=(e.value?JSON.parse(e.value):{})||{};return delete n[r],e.value=JSON.stringify(n),e},e,n,o,i)},i.increment=function(e,t,r,o,a,c,u){n("readwrite",u,function(n){i.getItem(e,t,function(u){u=u||{value:0},u.value!==r&&u.value++,u.saveTime=(new Date).getTime(),u.expireSeconds=o,i.setItem(e,t,u,function(){a&&a(u.value)},c,n)},c,n)},c)},i.setDictionary=function(e,n,r,o,i){t(function(n){for(var t in e)"value"!=t&&e.hasOwnProperty(t)&&(n[t]=e[t]);return n},n,r,o,i)},e.apply(null,arguments)}function createCallback(e,n){return function(t){sendMessage({num:e,success:n,obj:t})}}function sendMessage(e){postMessage(JSON.stringify(e))}var indexedDb=new IndexedDBManager;indexedDb.init(function(){sendMessage("ready")}),onmessage=function(e){var n=JSON.parse(e.data),t=n.num,r=n.guid,o=n.action,i=n.obj,a=createCallback(t,!0),c=createCallback(t,!1);switch(o){case"set":i.clearDict===!1?indexedDb.setDictionary(i.value,r,i.key,a,c):indexedDb.setItem(r,i.key,i.value,a,c);break;case"get":indexedDb.getItem(r,i.key,a,c);break;case"all":indexedDb.getAll(r,a,c);break;case"del":indexedDb.removeItem(r,i.key,a,c);break;case"add":indexedDb.addToDictionary(r,i.dict,i.key,i.value,a,c);break;case"rem":indexedDb.removeFromDictionary(r,i.dict,i.key,a,c);break;case"test":indexedDb.testConnection(a,c);break;case"inc":indexedDb.increment(r,i.key,i.lastValue,i.ttl,a,c)}};