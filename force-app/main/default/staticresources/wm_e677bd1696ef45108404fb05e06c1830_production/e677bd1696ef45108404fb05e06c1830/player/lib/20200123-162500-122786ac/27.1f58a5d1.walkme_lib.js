window._walkmeWebpackJP&&(window._walkmeWebpackJP=window._walkmeWebpackJP||[]).push([[27],{1374:function(e,n,t){(function(n,f){(function(){n.register("Segment").asCtor(function(n,e,a,i,g,t,o){var s={};this.start=function(){var e=t.get().JSONSettings;e&&(s=e["Segment.com"]||null);return new f(function(e){r("Bootstrap Segment integration. Create segmentation object and updating WalkMeAPI"),function(){i&&(i.Segment=i.Segment||{});i.Segment.userId||Object.defineProperty(i.Segment,"userId",{get:function(){try{return m()}catch(e){return void r.error(e,"Problem accessing Segment API")}}});n.Segment={identify:d,track:c},i.on(o.EVENTS.WalkmeReady,function(){r("Detecting if we have been called before WalkMeAPI was ready"),i.Segment&&i.Segment.preLoadedData&&(r("Fetching values from cache. Identify happened before WalkMeAPI was ready"),i.Segment=l(i.Segment.preLoadedData[0]))})}(),r("Creating outbound integration"),function(){if(!window._walkmeConfig||!window._walkmeConfig.segmentOptions||!window._walkmeConfig.segmentOptions.trackWalkMeEvents)return;i.on("AnalyticsEventSent",function(e,n){if(n&&n.eventData&&n.eventData.data){var a,i,o,t=n.eventData.data;if(s&&s.extendedEventProperties){var r=(a=s.extendedEventProperties,i={},o={cookie:0,var:1},Object.keys(a).forEach(function(e){if(Object.prototype.hasOwnProperty.call(a,e)){var n=a[e];if(n){var t=g.getWindowData(o[n.type],n.value);t&&(i[e]=t)}}}),i);t=wmjQuery.extend({},t,r)}window.beforeWalkMeSegmentEvent&&"function"==typeof beforeWalkMeSegmentEvent&&(t=beforeWalkMeSegmentEvent(t)),window.analytics&&window.analytics.track(u+n.eventData.type,t)}})}(),r("Calling Segment Connector telling we are ready"),window.walkme_segment_ready&&window.walkme_segment_ready(),r("Wait for analytics.identify to happen before continue loading"),function e(n,t){t=t||0;i.Segment&&i.Segment.userId?(r("Segment object is populated in _walkMeInternals. Continue loading",1),n()):a.libSetTimeout(function(){t<20?e(n,++t):(r("Unable to find segmentation variables populated. Segment's analytics.identify not getting called"),n())},200)}(e)})},this.getUserId=m;var r=e.wrapCustomerLog("SegmentIntegration");function d(e){r("Identify from Segment happened!"),i.Segment=l(e)}function c(){r("Track from Segment happened!")}function l(e){var n={};return e.userId()?(n.userId=String(e.userId()),n.isAnonUser=!1):(n.userId=String(e.anonymousId()),n.isAnonUser=!0),n.email=e.email(),n.traits=e.traits(),n}function m(){var e=null;try{e=(e=window.analytics.user().id())||window.analytics.user().anonymousId()}catch(e){r("ERROR retrieving Segment.com user: "+e.message)}finally{return e}}}).dependencies("ClassWalkMeAPI, Logger, TimerManager, WmInternals, CommonUtils, WalkmeConfigManager, Consts");var u="WalkMe_";e.exports={init:function(e){return n.get("Segment").start(e).catch(function(e){n.get("Logger").error(e)})}}}).call(window)}).call(this,t(3),t(2))}}]);